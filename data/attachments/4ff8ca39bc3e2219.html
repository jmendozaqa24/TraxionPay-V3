# Instructions

- Following Playwright test failed.
- Explain why, be concise, respect Playwright best practices.
- Provide a snippet of code with the fix, if possible.

# Test info

- Name: Login >> Login - Valid Input
- Location: C:\actions-runner\Automation\TraxionPay-V3\TraxionPay-V3\Main\Functional_Test\TPayWeb_V3\1_Login.spec.ts:49:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toHaveURL(expected)

Locator: locator(':root')
Expected string: "https://merchant-sit.traxionpay.com/"
Received string: "https://merchant-sit.traxionpay.com/signin"
Call log:
  - expect.toHaveURL with timeout 5000ms
  - waiting for locator(':root')
    9 × locator resolved to <html lang="en">…</html>
      - unexpected value "https://merchant-sit.traxionpay.com/signin"

    at C:\actions-runner\Automation\TraxionPay-V3\TraxionPay-V3\Main\Functional_Test\TPayWeb_V3\1_Login.spec.ts:73:24
```

# Page snapshot

```yaml
- heading "An error occurred" [level=1]
- heading "An error occurred during execution; please try again later." [level=2]
- separator
- heading "Additional information:" [level=2]
- heading "GuzzleHttp\\Exception\\ServerException" [level=3]
- term: "File:"
- definition: /var/www/html/vendor/guzzlehttp/guzzle/src/Exception/RequestException.php:111
- term: "Message:"
- definition: "Server error: `POST https://api-sit.traxionpay.com/auth/login` resulted in a `500 Internal Server Error` response: {\"data\":\"U2FsdGVkX19kQAU6wdKQP9idw2uNBjflsvvCJyfMLTKIdYT78MI1lGLeXCBCUffFAhB9JGoLqKt1aLZwMyzkvK4c4YM6ktkc7Qlqp2EPnjSmEdV (truncated...)"
- term: "Stack trace:"
- definition: "#0 /var/www/html/vendor/guzzlehttp/guzzle/src/Middleware.php(72): GuzzleHttp\\Exception\\RequestException::create(Object(GuzzleHttp\\Psr7\\Request), Object(GuzzleHttp\\Psr7\\Response), NULL, Array, NULL) #1 /var/www/html/vendor/guzzlehttp/promises/src/Promise.php(209): GuzzleHttp\\Middleware::GuzzleHttp\\{closure}(Object(GuzzleHttp\\Psr7\\Response)) #2 /var/www/html/vendor/guzzlehttp/promises/src/Promise.php(158): GuzzleHttp\\Promise\\Promise::callHandler(1, Object(GuzzleHttp\\Psr7\\Response), NULL) #3 /var/www/html/vendor/guzzlehttp/promises/src/TaskQueue.php(52): GuzzleHttp\\Promise\\Promise::GuzzleHttp\\Promise\\{closure}() #4 /var/www/html/vendor/guzzlehttp/promises/src/Promise.php(251): GuzzleHttp\\Promise\\TaskQueue->run(true) #5 /var/www/html/vendor/guzzlehttp/promises/src/Promise.php(227): GuzzleHttp\\Promise\\Promise->invokeWaitFn() #6 /var/www/html/vendor/guzzlehttp/promises/src/Promise.php(272): GuzzleHttp\\Promise\\Promise->waitIfPending() #7 /var/www/html/vendor/guzzlehttp/promises/src/Promise.php(229): GuzzleHttp\\Promise\\Promise->invokeWaitList() #8 /var/www/html/vendor/guzzlehttp/promises/src/Promise.php(69): GuzzleHttp\\Promise\\Promise->waitIfPending() #9 /var/www/html/vendor/guzzlehttp/guzzle/src/Client.php(189): GuzzleHttp\\Promise\\Promise->wait() #10 /var/www/html/vendor/guzzlehttp/guzzle/src/ClientTrait.php(95): GuzzleHttp\\Client->request('POST', '/auth/login', Array) #11 /var/www/html/module/Application/src/Library/ApiRequest.php(124): GuzzleHttp\\Client->post('/auth/login', Array) #12 /var/www/html/module/User/src/Controller/SigninController.php(103): Application\\Library\\ApiRequest->post('/auth/login', Array) #13 /var/www/html/vendor/laminas/laminas-mvc/src/Controller/AbstractActionController.php(72): User\\Controller\\SigninController->indexAction() #14 /var/www/html/vendor/laminas/laminas-eventmanager/src/EventManager.php(318): Laminas\\Mvc\\Controller\\AbstractActionController->onDispatch(Object(Laminas\\Mvc\\MvcEvent)) #15 /var/www/html/vendor/laminas/laminas-eventmanager/src/EventManager.php(176): Laminas\\EventManager\\EventManager->triggerListeners(Object(Laminas\\Mvc\\MvcEvent), Object(Closure)) #16 /var/www/html/vendor/laminas/laminas-mvc/src/Controller/AbstractController.php(105): Laminas\\EventManager\\EventManager->triggerEventUntil(Object(Closure), Object(Laminas\\Mvc\\MvcEvent)) #17 /var/www/html/vendor/laminas/laminas-mvc/src/DispatchListener.php(117): Laminas\\Mvc\\Controller\\AbstractController->dispatch(Object(Laminas\\Http\\PhpEnvironment\\Request), Object(Laminas\\Http\\PhpEnvironment\\Response)) #18 /var/www/html/vendor/laminas/laminas-eventmanager/src/EventManager.php(318): Laminas\\Mvc\\DispatchListener->onDispatch(Object(Laminas\\Mvc\\MvcEvent)) #19 /var/www/html/vendor/laminas/laminas-eventmanager/src/EventManager.php(176): Laminas\\EventManager\\EventManager->triggerListeners(Object(Laminas\\Mvc\\MvcEvent), Object(Closure)) #20 /var/www/html/vendor/laminas/laminas-mvc/src/Application.php(319): Laminas\\EventManager\\EventManager->triggerEventUntil(Object(Closure), Object(Laminas\\Mvc\\MvcEvent)) #21 /var/www/html/public/index.php(45): Laminas\\Mvc\\Application->run() #22 {main}"
- contentinfo:
  - list:
    - listitem:
      - link "Documentation"
  - list:
    - listitem:
      - text: Copyright © 2025
      - link "Traxion Tech Inc."
      - text: . All rights reserved.
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import userDetails from './userDetails.json'; 
   3 | import { allure } from 'allure-playwright';
   4 |
   5 | function getRandomCorrectUser() {
   6 |   const correctUsers = userDetails.correctUsers;
   7 |   const randomIndex = Math.floor(Math.random() * correctUsers.length);
   8 |   return correctUsers[randomIndex];
   9 | }
   10 |
   11 | function getRandomIncorrectUser() {
   12 |   const incorrectUsers = userDetails.incorrectUsers;
   13 |   const randomIndex = Math.floor(Math.random() * incorrectUsers.length);
   14 |   return incorrectUsers[randomIndex];
   15 | }
   16 |
   17 | function generateUniqueEmail() {
   18 |   const timestamp = Date.now();
   19 |   return `user${timestamp}@example.com`;
   20 | }
   21 |
   22 | function generateUniqueMobile() {
   23 |   const randomDigits = Math.floor(1000000000 + Math.random() * 9000000000);
   24 |   return `9${randomDigits}`;
   25 | } 
   26 |
   27 | function getRandomPassword() {
   28 |   const passwords = [
   29 |     'short', // Less than 8 characters
   30 |     'longenoughpassword' // 8 or more characters
   31 |   ];
   32 |   const randomIndex = Math.floor(Math.random() * passwords.length);
   33 |   return passwords[randomIndex];
   34 | }
   35 |
   36 | test.afterEach(async ({ page }) => {
   37 |   if (test.info().status !== "passed") { // Only take a screenshot when the test actually fails
   38 |     const screenshotPath = `screenshots/${test.info().title}.png`;
   39 |     await page.screenshot({ path: screenshotPath, fullPage: true });
   40 |     test.info().attachments.push({
   41 |       name: 'Screenshot',
   42 |       path: screenshotPath,
   43 |       contentType: 'image/png'
   44 |     });
   45 |   }
   46 | });
   47 |
   48 | test.describe('Login', () => {
   49 |   test('Login - Valid Input', async ({ page }) => {
   50 |     const correctUser = getRandomCorrectUser();
   51 |
   52 |     await page.route('https://merchant-sit.traxionpay.com/', route => {
   53 |       route.fulfill({
   54 |         status: 200,
   55 |         contentType: 'application/json',
   56 |         body: JSON.stringify({ success: true })
   57 |       });
   58 |     });
   59 |
   60 |     await page.goto('https://merchant-sit.traxionpay.com/signin');
   61 |
   62 |     await page.getByPlaceholder('your@email.com').fill(correctUser.email);
   63 |     await page.getByPlaceholder('your password').fill(correctUser.password);
   64 |
   65 |     // Add on this part the API validation
   66 |     const [response] = await Promise.all([
   67 |       page.waitForResponse(response => response.url().includes('https://merchant-sit.traxionpay.com/') && response.status() === 200),
   68 |       page.getByRole('button', { name: 'Sign in' }).click()
   69 |     ]);
   70 |     expect(response.status()).toBe(200);
   71 |
   72 |     // Verification
>  73 |     await expect(page).toHaveURL('https://merchant-sit.traxionpay.com');
      |                        ^ Error: Timed out 5000ms waiting for expect(locator).toHaveURL(expected)
   74 |     await expect(page.getByText('Overview')).toBeVisible();
   75 |     await expect(page.getByRole('heading', { name: 'Dashboard' })).toBeVisible();
   76 |   });
   77 |
   78 |   
   79 |   test.skip('Login - Show Password & Remember Me Functionality', async ({ page }) => {
   80 |     const correctUser = getRandomCorrectUser();
   81 |
   82 |     await page.goto('https://merchant-sit.traxionpay.com/signin');
   83 |
   84 |     await page.getByPlaceholder('your@email.com').fill(correctUser.email);
   85 |     await page.getByPlaceholder('your password').fill(correctUser.password);
   86 |
   87 |     await page.getByLabel('Show password').click();
   88 |     const passwordInput = await page.getByPlaceholder('your password');
   89 |     await expect(passwordInput).toHaveAttribute('type', 'text');
   90 |     
   91 |     await page.getByLabel('Remember me on this device').check();
   92 |     await expect(page.getByLabel('Remember me on this device')).toBeChecked();
   93 |     await page.getByRole('button', { name: 'Sign in' }).click();
   94 |
   95 |     await expect(page).toHaveURL('https://merchant-sit.traxionpay.com');
   96 |     await expect(page.getByText('Overview')).toBeVisible();
   97 |     await expect(page.getByRole('heading', { name: 'Dashboard' })).toBeVisible();
   98 |
   99 |     // Log out
  100 |     await page.getByLabel('Open user menu').click();
  101 |     await page.getByRole('link', { name: 'Signout' }).click();
  102 |
  103 |     // Navigate back to the login page
  104 |     await page.goto('https://merchant-sit.traxionpay.com/signin');
  105 |
  106 |     // Verify that the email and password are saved
  107 |     await expect(page.getByPlaceholder('your@email.com')).toHaveValue(correctUser.email);
  108 |     await expect(page.getByPlaceholder('your password')).toHaveValue(correctUser.password);
  109 |     // Verify that the "Remember me" checkbox is checked
  110 |     await expect(page.getByLabel('Remember me on this device')).toBeChecked();
  111 |
  112 |   });
  113 | });
  114 |
  115 | test.describe('Sign Up', () => {
  116 |   test('Sign Up - Success', async ({ page }) => {
  117 |     const uniqueEmail = generateUniqueEmail();
  118 |     const uniqueMobile = generateUniqueMobile();
  119 |
  120 |     await page.goto('https://merchant-sit.traxionpay.com/signin');
  121 |     await page.getByRole('link', { name: 'Sign up' }).click();
  122 |
  123 |     await expect(page).toHaveURL('https://merchant-sit.traxionpay.com/signup');
  124 |     await expect(page.getByText('Email address')).toBeVisible();
  125 |     await page.getByPlaceholder('your@email.com').fill(uniqueEmail);
  126 |     await expect(page.getByText('Mobile Number')).toBeVisible();
  127 |     await page.getByRole('textbox', { name: 'Mobile Number' }).fill(uniqueMobile);
  128 |     await page.getByRole('button', { name: 'Sign Up' }).click();
  129 |     
  130 |     await page.getByText('Enter the OTP we sent to your mobile number.').isVisible();
  131 |   });
  132 | });
  133 |
  134 | test.describe('Forgot Password', () => {
  135 |   test.skip('Forgot Password - Valid', async ({ page }) => {
  136 |     const correctUser = getRandomCorrectUser();
  137 |     
  138 |     await page.goto('https://merchant-sit.traxionpay.com/signin');
  139 |     await page.getByRole('link', { name: 'Forgot Password?' }).click();
  140 |     
  141 |     //verify test if visible
  142 |     await page.getByRole('heading', { name: 'Forgot Password' }).isVisible();
  143 |     await page.getByRole('textbox', { name: 'Email Address' }).isVisible();
  144 |     await page.getByRole('button', { name: 'Send Link' }).click();
  145 |
  146 |     //verification test the email reset is succesful
  147 |     await page.getByRole('textbox', { name: 'Email Address' }).fill(correctUser.email); 
  148 |     const [response] = await Promise.all([
  149 |         page.waitForResponse(response => response.url().includes('https://merchant-sit.traxionpay.com/signin/forgot-password') && response.status() === 200),
  150 |         page.getByRole('button', { name: 'Send Link' }).click()
  151 |     ]);
  152 |
  153 |     // Verify response status
  154 |     expect(response.status()).toBe(200);
  155 |     
  156 |   });
  157 | });
  158 |
  159 |
```