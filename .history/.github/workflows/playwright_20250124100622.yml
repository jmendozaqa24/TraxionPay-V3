name: Playwright Tests
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  #schedule:
    #- cron: '0 */1 * * *' # Runs every 4 hours

jobs:
#  run-all-tests:
#    timeout-minutes: 60
#    runs-on: self-hosted
#    steps:
#    - uses: actions/checkout@v4
#    - uses: actions/setup-node@v4
#      with:
#        node-version: lts/*
#    - name: Install dependencies
#      run: npm ci
#    - name: Install Playwright Browsers
#      run: npx playwright install --with-deps
#    - name: Run Playwright tests
#      run: #npx playwright test
#    - uses: actions/upload-artifact@v4
#      if: ${{ !cancelled() }}
#      with:
#        name: playwright-report
#        path: playwright-report/
#        retention-days: 30
#    - name: Send email with test results
#      if: always()
#      uses: dawidd6/action-send-mail@v3
#      with:
#        server_address: smtp-relay.brevo.com
#        server_port: 587
#       username: TraxionAutomationReport@smtp-brevo.com
#        password: xsmtpsib-4f0bcc1e2f16cc3d67b475d6546b50fee87dd6173961afb5b4defdd54d78898b-VDqZOFh6QWz95ICP
#       subject: Playwright Test Results
#        to: vasalanga@traxiontech.net
#        from: TraxionAutomationReport@smtp-brevo.com
#        body: |
#          The Playwright tests have completed. Please find the attached report.
#        attachments: playwright-report/index.html

  run-tpayweb-v3-tests:
    timeout-minutes: 60
    runs-on: self-hosted
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: lts/*
    - name: Install dependencies
      run: npm ci
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    - name: Generate Allure Report
      run: |
            npm run clean:allure
    - name: Run TPayWeb_V3 Playwright Tests
      run: npx playwright test TPayWeb_V3
    - name: Serve Allure Report
      run: |
        npx allure open allure-report --port 8080 &
        echo "Allure report is being served at http://localhost:8080"
    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: allure-report
        path: allure-report/
        retention-days: 30
    - name: Send email with test results for TPayWeb_V3
      if: always()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: vasalanga@traxiontecp
        subject: Playwright Test Resuh.net
        password: fiujwmwqaztqjbwlts for TPayWeb_V3
        to: salangavincent@gmail.com
        from: vasalanga@traxiontech.net
        body: |
          The Playwright tests for TPayWeb_V3 have completed. Please find the attached report.
        attachments: allure-report/index.html